(()=>{"use strict";function e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const t="SelectorList",r="Selector",n="RegularSelector",s="ExtendedSelector",o="AbsolutePseudoClass",i="RelativePseudoClass";class a{constructor(t){e(this,"children",[]),this.type=t}addChild(e){this.children.push(e)}}class l extends a{constructor(e){super(n),this.value=e}}class c extends a{constructor(e){super(i),this.name=e}}class d extends a{constructor(t){super(o),e(this,"value",""),this.name=t}}const u={LEFT:"[",RIGHT:"]"},h={LEFT:"(",RIGHT:")"},f={LEFT:"{",RIGHT:"}"},p="/",m="\\",w=" ",g=",",y=";",b=":",v="'",E='"',$="=",k="\t",S="\r",x="\n",T="\f",P=[w,k,S,x,T],R="*",A=w,O=">",N="+",C="~",I=[A,O,N,C],B=["[","]","(",")","{","}",p,m,y,b,g,v,E,"^","$",R,"#",".",A,O,N,C,k,S,x,T],M=[b,y,v,E,m,w,k,S,x,T],L="contains",F="has-text",D="-abp-contains",H="matches-css",_="matches-css-before",V="matches-css-after",U="matches-attr",W="matches-property",q="xpath",z="nth-ancestor",G=[L,F,D],j="upward",Q="remove",Y="-abp-has",K=["has",Y],X="is",J="not",Z=[L,F,D,H,_,V,U,W,q,z,j],ee=[...K,X,J],te=[...Z,...ee],re=[J,X],ne=":scope",se={AFTER:"after",BACKDROP:"backdrop",BEFORE:"before",CUE:"cue",CUE_REGION:"cue-region",FIRST_LETTER:"first-letter",FIRST_LINE:"first-line",FILE_SELECTION_BUTTON:"file-selector-button",GRAMMAR_ERROR:"grammar-error",MARKER:"marker",PART:"part",PLACEHOLDER:"placeholder",SELECTION:"selection",SLOTTED:"slotted",SPELLING_ERROR:"spelling-error",TARGET_TEXT:"target-text"},oe="content",ie="true",ae="global",le="Selector should be defined",ce="No style declaration found",de=`${le} before style declaration in stylesheet`,ue="Invalid style declaration",he="Unclosed style declaration",fe="Missing style property in declaration",pe="Missing style value in declaration",me="Style should be declared or :remove() pseudo-class should used",we="Comments are not supported",ge="At-rules are not supported",ye="Invalid :remove() pseudo-class in selector",be=`${le} before :remove() pseudo-class`,ve="Pseudo-class :remove() appears more than once in selector",Ee="Pseudo-class :remove() should be at the end of selector",$e=/\[-(?:ext)-([a-z-_]+)=(["'])((?:(?=(\\?))\4.)*?)\2\]/g,ke=(e,t,r,n)=>{const s=new RegExp(`([^\\\\]|^)\\\\${r}`,"g");return`:${t}(${n.replace(s,`$1${r}`)})`},Se=/\(:scope >/g,xe=/(:matches-css)-(before|after)\(/g,Te=(e,t,r)=>`${t}${h.LEFT}${r}${g}`,Pe=e=>(e=>{const t=e.replace($e,ke).replace(Se,"(>").replace(xe,Te);if(t.includes("[-ext-"))throw new Error(`Invalid extended-css old syntax selector: '${e}'`);return t})(e.trim()),Re="mark",Ae="word",Oe=(e,t)=>{let r="";const n=[];return e.split("").forEach((e=>{if(t.includes(e))return r.length>0&&(n.push({type:Ae,value:r}),r=""),void n.push({type:Re,value:e});r+=e})),r.length>0&&n.push({type:Ae,value:r}),n},Ne=e=>{const t=[];e.forEach((e=>t.push(e)));const r=[];for(;t.length;){const e=t.pop();if(!e)throw new Error("Unable to make array flat");Array.isArray(e)?e.forEach((e=>t.push(e))):r.push(e)}return r.reverse()},Ce=e=>e[0],Ie=e=>e[e.length-1],Be=e=>e[e.length-2],Me=(e,t,r)=>{const n=e[t];if(!n)throw new Error(r||`No array item found by index ${t}`);return n},Le="At least one of Selector node children should be RegularSelector",Fe=e=>(null==e?void 0:e.type)===t,De=e=>(null==e?void 0:e.type)===r,He=e=>(null==e?void 0:e.type)===n,_e=e=>e.type===s,Ve=e=>(null==e?void 0:e.type)===o,Ue=e=>(null==e?void 0:e.type)===i,We=e=>{if(null===e)throw new Error("Ast node should be defined");if(!Ve(e)&&!Ue(e))throw new Error("Only AbsolutePseudoClass or RelativePseudoClass ast node can have a name");if(!e.name)throw new Error("Extended pseudo-class should have a name");return e.name},qe=(e,t)=>{if(null===e)throw new Error("Ast node should be defined");if(!He(e)&&!Ve(e))throw new Error("Only RegularSelector ot AbsolutePseudoClass ast node can have a value");if(!e.value)throw new Error(t||"Ast RegularSelector ot AbsolutePseudoClass node should have a value");return e.value},ze=e=>e.filter(He),Ge=e=>{const t=ze(e),r=Ie(t);if(!r)throw new Error(Le);return r},je=(e,t)=>{if(1!==e.children.length)throw new Error(t);const r=Ce(e.children);if(!r)throw new Error(t);return r},Qe=e=>je(e,"Extended selector should be specified"),Ye=e=>{if(!Ue(e))throw new Error("Only RelativePseudoClass node can have relative SelectorList node as child");return je(e,`Missing arg for :${We(e)}() pseudo-class`)},Ke={COMMON:[h.LEFT,v,E,$,".",b,w],CONTAINS:[h.LEFT,v,E]},Xe=e=>te.includes(e),Je=e=>re.includes(e),Ze=(e,t)=>!(!e||!t)&&(I.includes(t)||e===Ae||t===R||"#"===t||"."===t||t===b||t===v||t===E||t===u.LEFT),et=(e,t,r)=>{const n=Ie(e.extendedPseudoNamesStack);if(!n)throw new Error("Regexp pattern allowed only in arg of extended pseudo-class");if(G.includes(n))return Ke.CONTAINS.includes(t);if(t===p&&n!==q){throw new Error(`Invalid regexp pattern for :${n}() pseudo-class ${r?`in arg part: '${r}'`:"arg"}`)}return Ke.COMMON.includes(t)},tt=(e,t)=>e===u.LEFT&&t!==m,rt=e=>{var t;if(!e.isAttributeBracketsOpen)return!1;const r=e.attributeBuffer.split(w).join(""),n=Oe(r,[...B,$]);const s=Ce(n),o=null==s?void 0:s.type,i=null==s?void 0:s.value;if(o===Re&&i!==m)throw new Error(`'[${e.attributeBuffer}]' is not a valid attribute due to '${i}' at start of it`);const a=Ie(n),l=null==a?void 0:a.type,c=null==a?void 0:a.value;if(c===$)throw new Error(`'[${e.attributeBuffer}]' is not a valid attribute due to '${$}'`);const d=n.findIndex((e=>e.type===Re&&e.value===$)),u=null===(t=Be(n))||void 0===t?void 0:t.value;if(-1===d)return l===Ae||u===m&&(c===E||c===v);const h=Me(n,d+1).value;if(!(h===v||h===E)){if(l===Ae)return!0;throw new Error(`'[${e.attributeBuffer}]' is not a valid attribute`)}return l===Ae&&"i"===(null==c?void 0:c.toLocaleLowerCase())?u===h:c===h},nt=e=>!!e&&P.includes(e),st=e=>Z.includes(e),ot=e=>ee.includes(e),it=e=>0===e.pathToBufferNode.length?null:Ie(e.pathToBufferNode)||null,at=e=>{const t=it(e);if(!t)throw new Error("No bufferNode found");if(!De(t))throw new Error("Unsupported bufferNode type");const r=Ge(t.children);return e.pathToBufferNode.push(r),r},lt=(e,t)=>{const r=it(e);if(null===r)throw new Error("No bufferNode to update");if(Ve(r))r.value+=t;else{if(!He(r))throw new Error(`${r.type} node cannot be updated. Only RegularSelector and AbsolutePseudoClass are supported`);r.value+=t,e.isAttributeBracketsOpen&&(e.attributeBuffer+=t)}},ct=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const s=it(e);if(null===s)throw new Error("No buffer node");let u;u=t===n?new l(r):t===o?new d(r):t===i?new c(r):new a(t),s.addChild(u),e.pathToBufferNode.push(u)},dt=(e,s)=>{(e=>{const r=new a(t);e.ast=r,e.pathToBufferNode.push(r)})(e),ct(e,r),ct(e,n,s)},ut=function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";ct(e,t),ct(e,r),ct(e,n,s)},ht=(e,t)=>{for(let n=e.pathToBufferNode.length-1;n>=0;n-=1){var r;if((null===(r=e.pathToBufferNode[n])||void 0===r?void 0:r.type)===t){e.pathToBufferNode=e.pathToBufferNode.slice(0,n+1);break}}},ft=e=>{const t=it(e);if(t&&Fe(t)&&Ue((e=>e.pathToBufferNode.length<2?null:Be(e.pathToBufferNode)||null)(e)))return t;ht(e,r);const n=it(e);if(!n)throw new Error("No SelectorNode, impossible to continue selector parsing by ExtendedCss");const s=Ie(n.children),o=s&&_e(s)&&0===e.standardPseudoBracketsStack.length,i=o&&Ce(s.children);let a=n;if(i){const t=o&&i.name,r=t&&ot(t),n=t&&st(t),l=r&&e.extendedPseudoBracketsStack.length>0&&e.extendedPseudoBracketsStack.length===e.extendedPseudoNamesStack.length,c=n&&t===Ie(e.extendedPseudoNamesStack);(l||c)&&(e.pathToBufferNode.push(s),a=i)}else a=o?n:at(e);return e.pathToBufferNode.push(a),a},pt=(e,t,n,o,i)=>{if(!o)throw new Error(`Invalid colon ':' at the end of selector: '${t}'`);if(Xe(o.toLowerCase())){if(K.includes(o)&&e.standardPseudoNamesStack.length>0)throw new Error(`Usage of :${o}() pseudo-class is not allowed inside regular pseudo: '${Ie(e.standardPseudoNamesStack)}'`);ht(e,r),ct(e,s)}else{if(o.toLowerCase()===Q)throw new Error(`${ye}: '${t}'`);lt(e,n),i&&i===h.LEFT&&!e.isAttributeBracketsOpen&&e.standardPseudoNamesStack.push(o)}},mt=`html ${R}`,wt=(e,t)=>(e.children=t,e),gt=e=>{if(null===e)return!1;const t=Qe(e),r=We(t);if(st(r))return!1;const n=Ye(t).children;if(Je(r)){if(n.every((e=>{try{const t=je(e,"Selector node should have RegularSelector");return He(t)}catch(e){return!1}})))return!0}return n.some((e=>e.children.some((e=>!!_e(e)&&gt(e)))))},yt=(e,t)=>{if(!e)return null;const r=Qe(e),n=Ye(r);if(!n.children.some((e=>e.children.some((e=>_e(e)))))){const e=(e=>e.children.map((e=>{const t=je(e,"Ast Selector node should have RegularSelector node");return qe(t)})).join(`${g}${w}`))(n),s=We(r),o=`${b}${s}${h.LEFT}${e}${h.RIGHT}`;return t.value=`${qe(t)}${o}`,null}const s=bt(n),o=wt(r,[s]);return wt(e,[o])},bt=e=>wt(e,e.children.map((e=>(e=>{const t=e.children,r=[];let n=0;for(;n<t.length;){const e=Me(t,n,"currentChild should be specified");if(0===n)r.push(e);else{const t=Ge(r);if(_e(e)){let n=null,s=gt(e);for(n=e;s;)n=yt(n,t),s=gt(n);if(null!==n){r.push(n);const e=Qe(n),s=We(e);qe(t)===R&&Je(s)&&(t.value=mt)}}else if(He(e)){const n=Ie(r)||null;He(n)&&(s=e,(o=t).value=`${qe(o)}${w}${qe(s)}`)}}n+=1}var s,o;return wt(e,r)})(e)))),vt="No white space is allowed before or after extended pseudo-class name in selector",Et=e=>{const a=(e=>{const t=Pe(e);return Oe(t,B)})(e),l={ast:null,pathToBufferNode:[],extendedPseudoNamesStack:[],extendedPseudoBracketsStack:[],standardPseudoNamesStack:[],standardPseudoBracketsStack:[],isAttributeBracketsOpen:!1,attributeBuffer:"",isRegexpOpen:!1,shouldOptimize:!1};let c=0;for(;c<a.length;){const d=a[c];if(!d)break;const{type:$,value:P}=d,B=a[c+1],M=null==B?void 0:B.type,L=null==B?void 0:B.value,F=a[c+2],D=null==F?void 0:F.value,H=a[c-1],_=null==H?void 0:H.type,V=null==H?void 0:H.value,U=a[c-2],W=null==U?void 0:U.value;let G=it(l);switch($){case Ae:if(null===G)dt(l,P);else if(Fe(G))ct(l,r),ct(l,n,P);else if(He(G))lt(l,P);else if(_e(G)){if(nt(L)&&D===h.LEFT)throw new Error(`${vt}: '${e}'`);const t=P.toLowerCase();l.extendedPseudoNamesStack.push(t),st(t)?ct(l,o,t):(ct(l,i,t),Je(t)&&(l.shouldOptimize=!0))}else Ve(G)?lt(l,P):Ue(G)&&ut(l,P);break;case Re:switch(P){case g:if(!G||void 0!==G&&!L)throw new Error(`'${e}' is not a valid selector`);He(G)?l.isAttributeBracketsOpen?lt(l,P):ht(l,t):Ve(G)?lt(l,P):De(G)&&ht(l,t);break;case w:if(He(G)&&!l.isAttributeBracketsOpen&&(G=ft(l)),He(G)){if(!l.isAttributeBracketsOpen&&(V===b&&M===Ae||_===Ae&&L===h.LEFT))throw new Error(`'${e}' is not a valid selector`);(!L||Ze(M,L)||l.isAttributeBracketsOpen)&&lt(l,P)}Ve(G)&&lt(l,P),Ue(G)&&ut(l),De(G)&&Ze(M,L)&&ct(l,n);break;case A:case O:case N:case C:case y:case p:case m:case v:case E:case"^":case"$":case f.LEFT:case f.RIGHT:case R:case"#":case".":case u.LEFT:if(I.includes(P)){if(null===G)throw new Error(`'${e}' is not a valid selector`);G=ft(l)}if(null===G)dt(l,P),tt(P,V)&&(l.isAttributeBracketsOpen=!0);else if(He(G)){if(P===f.LEFT&&!l.isAttributeBracketsOpen&&!l.isRegexpOpen)throw new Error(`'${e}' is not a valid selector`);lt(l,P),tt(P,V)&&(l.isAttributeBracketsOpen=!0)}else Ve(G)?(lt(l,P),P===p&&l.extendedPseudoNamesStack.length>0&&(V===p&&W===m?l.isRegexpOpen=!1:V&&V!==m&&(et(l,V,qe(G))?l.isRegexpOpen=!l.isRegexpOpen:l.isRegexpOpen=!1))):Ue(G)?(ut(l,P),tt(P,V)&&(l.isAttributeBracketsOpen=!0)):De(G)?I.includes(P)?ct(l,n,P):l.isRegexpOpen||(G=at(l),lt(l,P),tt(P,V)&&(l.isAttributeBracketsOpen=!0)):Fe(G)&&(ct(l,r),ct(l,n,P),tt(P,V)&&(l.isAttributeBracketsOpen=!0));break;case u.RIGHT:if(He(G)){if(!l.isAttributeBracketsOpen&&V!==m)throw new Error(`'${e}' is not a valid selector due to '${P}' after '${qe(G)}'`);rt(l)&&(l.isAttributeBracketsOpen=!1,l.attributeBuffer=""),lt(l,P)}Ve(G)&&lt(l,P);break;case b:if(nt(L)&&D&&te.includes(D))throw new Error(`${vt}: '${e}'`);if(null===G){if(L===q)dt(l,"body");else{if(L===j||L===z)throw new Error(`${le} before :${L}() pseudo-class`);dt(l,R)}G=it(l)}if(Fe(G)&&(ct(l,r),ct(l,n),G=it(l)),He(G)&&((V&&I.includes(V)||V===g)&&lt(l,R),pt(l,e,P,L,D)),De(G)){if(!L)throw new Error(`Invalid colon ':' at the end of selector: '${e}'`);if(Xe(L.toLowerCase()))ct(l,s);else{if(L.toLowerCase()===Q)throw new Error(`${ye}: '${e}'`);G=at(l),pt(l,e,P,M,D)}}if(Ve(G)){if(We(G)===q&&L&&te.includes(L)&&D===h.LEFT)throw new Error(`:xpath() pseudo-class should be the last in selector: '${e}'`);lt(l,P)}if(Ue(G)){if(!L)throw new Error(`Invalid pseudo-class arg at the end of selector: '${e}'`);ut(l,R),Xe(L.toLowerCase())?(ht(l,r),ct(l,s)):(lt(l,P),D===h.LEFT&&l.standardPseudoNamesStack.push(L))}break;case h.LEFT:Ve(G)&&(We(G)!==q&&l.isRegexpOpen?lt(l,P):(l.extendedPseudoBracketsStack.push(P),l.extendedPseudoBracketsStack.length>l.extendedPseudoNamesStack.length&&lt(l,P))),He(G)&&(l.standardPseudoNamesStack.length>0&&(lt(l,P),l.standardPseudoBracketsStack.push(P)),l.isAttributeBracketsOpen&&lt(l,P)),Ue(G)&&l.extendedPseudoBracketsStack.push(P);break;case h.RIGHT:if(Ve(G)&&(We(G)!==q&&l.isRegexpOpen?lt(l,P):(l.extendedPseudoBracketsStack.pop(),We(G)!==q?(l.extendedPseudoNamesStack.pop(),l.extendedPseudoBracketsStack.length>l.extendedPseudoNamesStack.length?lt(l,P):l.extendedPseudoBracketsStack.length>=0&&l.extendedPseudoNamesStack.length>=0&&ht(l,r)):l.extendedPseudoBracketsStack.length<l.extendedPseudoNamesStack.length?l.extendedPseudoNamesStack.pop():lt(l,P))),He(G))if(l.isAttributeBracketsOpen)lt(l,P);else if(l.standardPseudoNamesStack.length>0&&l.standardPseudoBracketsStack.length>0){lt(l,P),l.standardPseudoBracketsStack.pop();const t=l.standardPseudoNamesStack.pop();if(!t)throw new Error(`Parsing error. Invalid selector: ${e}`);if(Object.values(se).includes(t)&&L===b&&D&&K.includes(D))throw new Error(`Usage of :${D}() pseudo-class is not allowed after any regular pseudo-element: '${t}'`)}else l.extendedPseudoBracketsStack.pop(),l.extendedPseudoNamesStack.pop(),ht(l,s),ht(l,r);De(G)&&(l.extendedPseudoBracketsStack.pop(),l.extendedPseudoNamesStack.pop(),ht(l,s),ht(l,r)),Ue(G)&&l.extendedPseudoNamesStack.length>0&&l.extendedPseudoBracketsStack.length>0&&(l.extendedPseudoBracketsStack.pop(),l.extendedPseudoNamesStack.pop());break;case x:case T:case S:throw new Error(`'${e}' is not a valid selector`);case k:if(!He(G)||!l.isAttributeBracketsOpen)throw new Error(`'${e}' is not a valid selector`);lt(l,P)}break;default:throw new Error(`Unknown type of token: '${P}'`)}c+=1}if(null===l.ast)throw new Error(`'${e}' is not a valid selector`);if(l.extendedPseudoNamesStack.length>0||l.extendedPseudoBracketsStack.length>0)throw new Error(`Unbalanced brackets for extended pseudo-class: '${Ie(l.extendedPseudoNamesStack)}'`);if(l.isAttributeBracketsOpen)throw new Error(`Unbalanced attribute brackets in selector: '${e}'`);return l.shouldOptimize?(d=l.ast,bt(d)):l.ast;var d},$t={MutationObserver:window.MutationObserver||window.WebKitMutationObserver};const kt=new class{constructor(){this.nativeNode=window.Node||Node}setGetter(){var e;this.getter=null===(e=Object.getOwnPropertyDescriptor(this.nativeNode.prototype,"textContent"))||void 0===e?void 0:e.get}},St=e=>{let t=e.tagName.toLowerCase();return t+=Array.from(e.attributes).map((t=>`[${t.name}="${e.getAttribute(t.name)}"]`)).join(""),t},xt=e=>e instanceof HTMLElement,Tt=(e,t)=>{const{parentElement:r}=e;if(!r)throw new Error(t||"Element does no have parent element");return r},Pt=e=>(e=>{if("object"==typeof(t=e)&&null!==t&&"message"in t&&"string"==typeof t.message)return e;var t;try{return new Error(JSON.stringify(e))}catch{return new Error(String(e))}})(e).message,Rt={error:"undefined"!=typeof console&&console.error&&console.error.bind?console.error.bind(window.console):console.error,info:"undefined"!=typeof console&&console.info&&console.info.bind?console.info.bind(window.console):console.info},At=(e,t,r)=>e?e.split(t).join(r):e,Ot=e=>{let t;switch(e){case void 0:t="undefined";break;case null:t="null";break;default:t=e.toString()}return t},Nt=e=>{const t=Number(e);let r;if(Number.isNaN(t))switch(e){case"undefined":r=void 0;break;case"null":r=null;break;case"true":r=!0;break;case"false":r=!1;break;default:r=e}else r=t;return r},Ct=/\sVersion\/(\d{2}\.\d)(.+\s|\s)(Safari)\//.test(navigator.userAgent),It="background",Bt="background-image",Mt="content",Lt="opacity",Ft=/^\s*\/.*\/[gmisuy]*\s*$/,Dt=e=>{if(!e.includes('url("')){const t=/url\((.*?)\)/g;return e.replace(t,'url("$1")')}return e},Ht=e=>e.replace(/(\^)?url(\\)?\\\((\w|\[\w)/g,'$1url$2\\(\\"?$3'),_t=Dt,Vt=e=>{let t;return e.startsWith(p)&&e.endsWith(p)?(t=Ht(e),t=t.slice(1,-1)):(t=_t(e),t=t.replace(/\\([\\()[\]"])/g,"$1"),t=(e=>{const t=new RegExp(`[${[".","+","?","$","{","}","(",")","[","]","\\","/"].join("\\")}]`,"g");return e.replace(t,"\\$&")})(t),t=At(t,R,".*")),new RegExp(t,"i")},Ut=(e,t,r)=>((e,t)=>{let r="";switch(e){case It:case Bt:r=Dt(t);break;case Mt:r=t.replace(/^(["'])([\s\S]*)\1$/,"$2");break;case Lt:r=Ct?(Math.round(100*parseFloat(t))/100).toString():t;break;default:r=t}return r})(t,window.getComputedStyle(e,r).getPropertyValue(t)),Wt=(e,t)=>{const r=e.indexOf(t);let n,s;return r>-1?(n=e.substring(0,r).trim(),s=e.substring(r+1).trim()):n=e,{name:n,value:s}},qt=e=>{const{pseudoName:t,pseudoArg:r,domElement:n}=e,{regularPseudoElement:s,styleMatchArg:o}=((e,t)=>{const{name:r,value:n}=Wt(t,g);let s=r,o=n;if(Object.values(se).includes(r)||(s=null,o=t),!o)throw new Error(`Required style property argument part is missing in :${e}() arg: '${t}'`);return s&&(s=`${b}${b}${s}`),{regularPseudoElement:s,styleMatchArg:o}})(t,r),{name:i,value:a}=Wt(o,b);if(!i||!a)throw new Error(`Required property name or value is missing in :${t}() arg: '${o}'`);let l;try{l=Vt(a)}catch(e){throw Rt.error(Pt(e)),new Error(`Invalid argument of :${t}() pseudo-class: '${o}'`)}const c=Ut(n,i,s);return l&&l.test(c)},zt=function(e){let t,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.length>1&&e.startsWith(E)&&e.endsWith(E)&&(e=e.slice(1,-1)),""===e)throw new Error("Argument should be specified. Empty arg is invalid.");if(e.startsWith(p)&&e.endsWith(p)){if(!(e.length>2))throw new Error(`Invalid regexp: '${e}'`);t=(e=>{if(e.startsWith(p)&&e.endsWith(p))return new RegExp(e.slice(1,-1));const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(t)})(e)}else if(e.includes(R)){if(e===R&&!r)throw new Error(`Argument should be more specific than ${e}`);t=At(e,R,".*"),t=new RegExp(t)}else{if(!(e=>!e.includes(p)&&!!/^[\w-]+$/.test(e))(e))throw new Error(`Invalid argument: '${e}'`);t=e}return t},Gt=(e,t)=>{const{name:r,value:n}=Wt(t,$);if(!r)throw new Error(`Required attribute name is missing in :${e} arg: ${t}`);return{rawName:r,rawValue:n}},jt=e=>{const{pseudoName:t,pseudoArg:r,domElement:n}=e,s=n.attributes;if(0===s.length)return!1;const{rawName:o,rawValue:i}=Gt(t,r);let a;try{a=zt(o)}catch(e){const t=Pt(e);throw Rt.error(t),new SyntaxError(t)}let l=!1,c=0;for(;c<s.length&&!l;){const e=s[c];if(!e)break;const t=a instanceof RegExp?a.test(e.name):a===e.name;if(i){let r;try{r=zt(i)}catch(e){const t=Pt(e);throw Rt.error(t),new SyntaxError(t)}const n=r instanceof RegExp?r.test(e.value):r===e.value;l=t&&n}else l=t;c+=1}return l},Qt=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const n=Ce(t);if(1===t.length){let t;for(t in e)n instanceof RegExp?n.test(t)&&r.push({base:e,prop:t,value:e[t]}):n===t&&r.push({base:e,prop:n,value:e[t]});return r}if(n instanceof RegExp){const s=t.slice(1),o=[];for(const t in e)n.test(t)&&o.push(t);o.forEach((t=>{var n;const o=null===(n=Object.getOwnPropertyDescriptor(e,t))||void 0===n?void 0:n.value;Qt(o,s,r)}))}if(e&&"string"==typeof n){var s;const o=null===(s=Object.getOwnPropertyDescriptor(e,n))||void 0===s?void 0:s.value;t=t.slice(1),void 0!==o&&Qt(o,t,r)}return r},Yt=e=>{const{pseudoName:t,pseudoArg:r,domElement:n}=e,{rawName:s,rawValue:o}=Gt(t,r);if(s.includes("\\/")||s.includes("\\."))throw new Error(`Invalid :${t} name pattern: ${s}`);let i;try{i=(e=>{e.length>1&&e.startsWith(E)&&e.endsWith(E)&&(e=e.slice(1,-1));const t=e.split("."),r=[];let n="",s=!1,o=0;for(;o<t.length;){const i=Me(t,o,`Invalid pseudo-class arg: '${e}'`);i.startsWith(p)&&i.endsWith(p)&&i.length>2?r.push(i):i.startsWith(p)?(s=!0,n+=i):i.endsWith(p)?(s=!1,n+=`.${i}`,r.push(n),n=""):s?n+=i:r.push(i),o+=1}if(n.length>0)throw new Error(`Invalid regexp property pattern '${e}'`);return r.map((t=>{if(0===t.length)throw new Error(`Empty pattern '${t}' is invalid in chain '${e}'`);let r;try{r=zt(t,!0)}catch(r){throw Rt.error(Pt(r)),new Error(`Invalid property pattern '${t}' in property chain '${e}'`)}return r}))})(s)}catch(e){const t=Pt(e);throw Rt.error(t),new SyntaxError(t)}const a=Qt(n,i);if(0===a.length)return!1;let l=!0;if(o){let e;try{e=zt(o)}catch(e){const t=Pt(e);throw Rt.error(t),new SyntaxError(t)}if(e)for(let t=0;t<a.length;t+=1){var c;const r=null===(c=a[t])||void 0===c?void 0:c.value;if(e instanceof RegExp)l=e.test(Ot(r));else{if("null"===r||"undefined"===r){l=e===r;break}l=Nt(e)===r}if(l)break}}return l},Kt=e=>{const{pseudoName:t,pseudoArg:r,domElement:n}=e,s=(e=>kt.getter?kt.getter.apply(e):e.textContent||"")(n);let o,i=r;if(i.startsWith(p)&&Ft.test(i)){const e=i.lastIndexOf("/"),n=i.substring(e+1);let a;i=i.substring(0,e+1).slice(1,-1).replace(/\\([\\"])/g,"$1");try{a=new RegExp(i,n)}catch(e){throw new Error(`Invalid argument of :${t}() pseudo-class: ${r}`)}o=a.test(s)}else i=i.replace(/\\([\\()[\]"])/g,"$1"),o=s.includes(i);return o},Xt=(e,t,r)=>`Error while matching element ${e}, may be invalid :${t}() pseudo-class arg: '${r}'`,Jt=(e,t,r)=>{let n,s,o;switch(t){case L:case F:case D:o=Kt,n={pseudoName:t,pseudoArg:r,domElement:e},s=Xt("text content",t,r);break;case H:case V:case _:o=qt,n={pseudoName:t,pseudoArg:r,domElement:e},s=Xt("style",t,r);break;case U:o=jt,n={domElement:e,pseudoName:t,pseudoArg:r},s=Xt("attributes",t,r);break;case W:o=Yt,n={domElement:e,pseudoName:t,pseudoArg:r},s=Xt("properties",t,r);break;default:throw new Error(`Unknown absolute pseudo-class :${t}()`)}return((e,t,r)=>{let n;try{n=e(t)}catch(e){throw Rt.error(Pt(e)),new Error(r)}return n})(o,n,s)},Zt=(e,t,r)=>{const n=((e,t)=>{const r=Number(e);if(Number.isNaN(r)||r<1||r>=256)throw new Error(`Invalid argument of :${t} pseudo-class: '${e}'`);return r})(t,r),s=e.map((e=>{let t=null;try{t=((e,t,r)=>{let n=null,s=0;for(;s<t;){if(n=e.parentElement,!n)throw new Error(`Out of DOM: Argument of :${r}() pseudo-class is too big — '${t}'.`);e=n,s+=1}return n})(e,n,r)}catch(e){Rt.error(Pt(e))}return t})).filter(xt);return s},er=(e,t)=>{const r=e.map((e=>{const r=[];let n;try{n=document.evaluate(t,e,null,window.XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null)}catch(e){throw Rt.error(Pt(e)),new Error(`Invalid argument of :xpath() pseudo-class: '${t}'`)}let s=n.iterateNext();for(;s;)xt(s)&&r.push(s),s=n.iterateNext();return r}));return Ne(r)},tr=(e,t)=>{if(!(e=>{let t;try{document.querySelectorAll(e),t=!0}catch(e){t=!1}return t})(t))throw new Error(`Invalid argument of :upward pseudo-class: '${t}'`);return e.map((e=>{const r=e.parentElement;return r?r.closest(t):null})).filter(xt)},rr=`${ne}${O}`,nr=`${ne}${A}`,sr=(e,t)=>((e,t)=>{const r=ze(e),n=Ce(r);if(!n)throw new Error(t||Le);return n})(e.children,`RegularSelector is missing for :${t}() pseudo-class`),or=(e,t,r)=>{const n=r||qe(e);let s=[];try{s=Array.from(t.querySelectorAll(n))}catch(e){throw new Error(`Error: unable to select by '${n}' — ${Pt(e)}`)}return s},ir=(e,t)=>{let r=[];const n=Qe(t),s=We(n);if(st(s)){const t=qe(n,`Missing arg for :${s}() pseudo-class`);if(s===z)r=Zt(e,t,s);else if(s===q){try{document.createExpression(t,null)}catch(e){throw new Error(`Invalid argument of :${s}() pseudo-class: '${t}'`)}r=er(e,t)}else r=s===j?Number.isNaN(Number(t))?tr(e,t):Zt(e,t,s):e.filter((e=>Jt(e,s,t)))}else{if(!ot(s))throw new Error(`Unknown extended pseudo-class: '${s}'`);{const t=Ye(n);let o;switch(s){case"has":case Y:o=e=>(e=>{const{element:t,relativeSelectorList:r,pseudoName:n}=e;return r.children.every((e=>{const r=sr(e,n);let s="",o=null;const i=qe(r);if(i.startsWith(N)||i.startsWith(C)){o=t.parentElement;const e=St(t);s=`${rr}${e}${i}`}else i===R?(o=t,s=`${nr}${R}`):(s=`${nr}${i}`,o=t);if(!o)throw new Error(`Selection by :${n}() pseudo-class is not possible`);let a;try{a=lr(e,o,s)}catch(e){throw Rt.error(Pt(e)),new Error(`Invalid selector for :${n}() pseudo-class: '${i}'`)}return a.length>0}))})({element:e,relativeSelectorList:t,pseudoName:s});break;case X:o=e=>(e=>{const{element:t,relativeSelectorList:r,pseudoName:n}=e;return r.children.some((e=>{const r=sr(e,n),s=Tt(t,`Selection by :${n}() pseudo-class is not possible`),o=`${rr}${qe(r)}`;let i;try{i=lr(e,s,o)}catch(e){return!1}return i.includes(t)}))})({element:e,relativeSelectorList:t,pseudoName:s});break;case J:o=e=>(e=>{const{element:t,relativeSelectorList:r,pseudoName:n}=e;return r.children.every((e=>{const r=sr(e,n),s=Tt(t,`Selection by :${n}() pseudo-class is not possible`),o=`${rr}${qe(r)}`;let i;try{i=lr(e,s,o)}catch(e){throw Rt.error(Pt(e)),new Error(`Invalid selector for :${n}() pseudo-class: '${qe(r)}'`)}return!i.includes(t)}))})({element:e,relativeSelectorList:t,pseudoName:s});break;default:throw new Error(`Unknown relative pseudo-class: '${s}'`)}r=e.filter(o)}}return r},ar=(e,t)=>{let r=[];const n=qe(t);return r=n.startsWith(O)?e.map((e=>or(t,e,`${ne}${n}`))):n.startsWith(N)||n.startsWith(C)?e.map((e=>{const r=e.parentElement;if(!r)return[];const s=St(e);return or(t,r,`${rr}${s}${n}`)})):e.map((e=>{const r=`${nr}${qe(t)}`;return or(t,e,r)})),Ne(r)},lr=(e,t,r)=>{let n=[],s=0;for(;s<e.children.length;){const o=Me(e.children,s,"selectorNodeChild should be specified");0===s?n=or(o,t,r):_e(o)?n=ir(n,o):He(o)&&(n=ar(n,o)),s+=1}return n},cr=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document;const r=[];e.children.forEach((e=>{r.push(...lr(e,t))}));return[...new Set(Ne(r))]};const dr=new class{constructor(){this.astCache=new Map}saveAstToCache(e,t){this.astCache.set(e,t)}getAstFromCache(e){return this.astCache.get(e)||null}getSelectorAst(e){let t=this.getAstFromCache(e);return t||(t=Et(e)),this.saveAstToCache(e,t),t}querySelectorAll(e){const t=this.getSelectorAst(e);return cr(t)}},ur="debug",hr=e=>{const t=`${b}${Q}${h.LEFT}${h.RIGHT}`,r=`${b}${Q}${h.LEFT}`;let n,s=!1;const o=e.indexOf(t);if(0===o)throw new Error(`${be}: '${e}'`);if(o>0){if(o!==e.lastIndexOf(t))throw new Error(`${ve}: '${e}'`);if(o+t.length<e.length)throw new Error(`${Ee}: '${e}'`);n=e.substring(0,o),s=!0}else{if(e.includes(r))throw new Error(`${ye}: '${e}'`);n=e}return{selector:n,stylesOfSelector:s?[{property:Q,value:ie}]:[]}},fr=(e,t)=>{let r,n=e.trim();if(n.startsWith("@"))throw new Error(`${ge}: '${n}'.`);try{r=hr(n)}catch(e){throw Rt.error(Pt(e)),new Error(`${ye}: '${n}'`)}let s,o=[],i=!1;try{n=r.selector,o=r.stylesOfSelector,s=t.getSelectorAst(n),i=!0}catch(e){i=!1}return{success:i,selector:n,ast:s,stylesOfSelector:o}},pr=()=>new Map,mr=(e,t)=>{const{selector:r,ast:n,rawStyles:s}=t;if(!s)throw new Error(`No style declaration for selector: '${r}'`);if(!n)throw new Error(`No ast parsed for selector: '${r}'`);const o=e.get(r);o?o.styles.push(...s):e.set(r,{ast:n,styles:s})},wr=e=>{const{selector:t,ast:r,rawStyles:n}=e;if(!r)throw new Error(`AST should be parsed for selector: '${t}'`);if(!n)throw new Error(`Styles should be parsed for selector: '${t}'`);const s={selector:t,ast:r},o=(e=>{const t=e.find((e=>e.property===ur));return null==t?void 0:t.value})(n),i=(e=>e.some((e=>e.property===Q&&e.value===ie)))(n);let a=n;if(o&&(a=n.filter((e=>e.property!==ur)),o!==ie&&o!==ae||(s.debug=o)),i){s.style={[Q]:ie};const e=a.find((e=>e.property===oe));e&&(s.style[oe]=e.value)}else if(a.length>0){const e=(e=>{const t={};return e.forEach((e=>{const[r,n]=e;t[r]=n})),t})(a.map((e=>{const{property:t,value:r}=e;return[t,r]})));s.style=e}return s},gr=e=>{const t=[];return e.forEach(((e,r)=>{const n=r,{ast:s,styles:o}=e;t.push(wr({selector:n,ast:s,rawStyles:o}))})),t},yr="property",br="value",vr=e=>""!==e.bufferValue&&null!==e.valueQuoteMark,Er=e=>{e.styles.push({property:e.bufferProperty.trim(),value:e.bufferValue.trim()}),e.bufferProperty="",e.bufferValue=""},$r=(e,t,r)=>{const{value:n}=r;switch(r.type){case Ae:if(e.bufferProperty.length>0)throw new Error(`Invalid style property in style block: '${t}'`);e.bufferProperty+=n;break;case Re:if(n===b){if(0===e.bufferProperty.trim().length)throw new Error(`Missing style property before ':' in style block: '${t}'`);e.bufferProperty=e.bufferProperty.trim(),e.processing=br}else if(!P.includes(n))throw new Error(`Invalid style declaration in style block: '${t}'`);break;default:throw new Error(`Unsupported style property character: '${n}' in style block: '${t}'`)}},kr=(e,t,r)=>{const{value:n}=r;if(r.type===Ae)e.bufferValue+=n;else switch(n){case b:if(!vr(e))throw new Error(`Invalid style value for property '${e.bufferProperty}' in style block: '${t}'`);e.bufferValue+=n;break;case y:vr(e)?e.bufferValue+=n:(Er(e),e.processing=yr);break;case v:case E:null===e.valueQuoteMark?e.valueQuoteMark=n:e.bufferValue.endsWith(m)||e.valueQuoteMark!==n||(e.valueQuoteMark=null),e.bufferValue+=n;break;case m:if(!vr(e))throw new Error(`Invalid style value for property '${e.bufferProperty}' in style block: '${t}'`);e.bufferValue+=n;break;case w:case k:case S:case x:case T:e.bufferValue.length>0&&(e.bufferValue+=n);break;default:throw new Error(`Unknown style declaration token: '${n}'`)}},Sr=e=>{const t=e.trim(),r=(e=>{const t=e.trim();return Oe(t,M)})(t),n={processing:yr,styles:[],bufferProperty:"",bufferValue:"",valueQuoteMark:null};let s=0;for(;s<r.length;){const e=r[s];if(!e)break;if(n.processing===yr)$r(n,t,e);else{if(n.processing!==br)throw new Error("Style declaration parsing failed");kr(n,t,e)}s+=1}if(vr(n))throw new Error(`Unbalanced style declaration quotes in style block: '${t}'`);if(n.bufferProperty.length>0){if(0===n.bufferValue.length)throw new Error(`Missing style value for property '${n.bufferProperty}' in style block '${t}'`);Er(n)}if(0===n.styles.length)throw new Error(ce);return n.styles},xr=(e,t)=>{var r;const n=e.trim();if(n.includes(`${p}${R}`)&&n.includes(`${R}${p}`))throw new Error(we);const s=(e=>{const t=[];for(let r=0;r<e.length;r+=1)e[r]===f.LEFT&&t.push(r);return t})(n);if(0===Ce(s))throw new Error(le);let o,i,a;if(s.length>0&&!n.includes(f.RIGHT))throw new Error(`${ce} OR ${he}`);if(0===s.length||!n.includes(f.RIGHT))try{if(o=fr(n,t),o.success){var l;if(0===(null===(l=o.stylesOfSelector)||void 0===l?void 0:l.length))throw new Error(me);return{selector:o.selector.trim(),ast:o.ast,rawStyles:o.stylesOfSelector}}throw new Error("Invalid selector")}catch(e){throw new Error(Pt(e))}const c={selector:""};for(let e=s.length-1;e>-1;e-=1){const r=s[e];if(!r)throw new Error(`Impossible to continue, no '{' to process for rule: '${n}'`);if(i=n.slice(0,r),a=n.slice(r+1,n.length-1),o=fr(i,t),o.success){var d;c.selector=o.selector.trim(),c.ast=o.ast,c.rawStyles=o.stylesOfSelector;const e=Sr(a);null===(d=c.rawStyles)||void 0===d||d.push(...e);break}}if(0===(null===(r=c.selector)||void 0===r?void 0:r.length))throw new Error("Selector in not valid");return c},Tr=/[;}]/g,Pr=/[;:}]/g,Rr=/\S/g,Ar=e=>{e.rawRuleData={selector:""}},Or=(e,t)=>{let r,n=e.selectorBuffer.trim();if(n.startsWith("@"))throw new Error(`${ge}: '${n}'.`);try{r=hr(n)}catch(e){throw Rt.error(Pt(e)),new Error(`${ye}: '${n}'`)}if(-1===e.nextIndex){if(n===r.selector)throw new Error(`${me}: '${e.cssToParse}'`);e.cssToParse=""}let s,o=[],i=!1;try{n=r.selector,o=r.stylesOfSelector,s=t.getSelectorAst(n),i=!0}catch(e){i=!1}return e.nextIndex>0&&(e.cssToParse=e.cssToParse.slice(e.nextIndex)),{success:i,selector:n,ast:s,stylesOfSelector:o}},Nr=(e,t)=>{Pr.lastIndex=e.nextIndex;let r=Pr.exec(e.cssToParse);if(null===r)throw new Error(`${ue}: '${e.cssToParse}'`);let n=r.index,s=r[0];if(s===f.RIGHT){if(0!==e.cssToParse.slice(e.nextIndex,n).trim().length)throw new Error(`${ue}: '${e.cssToParse}'`);if(0===t.length)throw new Error(`${ce}: '${e.cssToParse}'`);return n}if(s===b){const o=n;if(Tr.lastIndex=o,r=Tr.exec(e.cssToParse),null===r)throw new Error(`${he}: '${e.cssToParse}'`);n=r.index,s=r[0];const i=e.cssToParse.slice(e.nextIndex,o).trim();if(0===i.length)throw new Error(`${fe}: '${e.cssToParse}'`);const a=e.cssToParse.slice(o+1,n).trim();if(0===a.length)throw new Error(`${pe}: '${e.cssToParse}'`);if(t.push({property:i,value:a}),s===f.RIGHT)return n}return e.cssToParse=e.cssToParse.slice(n+1),e.nextIndex=0,Nr(e,t)},Cr=e=>{const t=[],r=Nr(e,t);Rr.lastIndex=r+1;const n=Rr.exec(e.cssToParse);if(null===n)return e.cssToParse="",t;const s=n.index;return e.cssToParse=e.cssToParse.slice(s),t},Ir=e=>"number"==typeof e&&!Number.isNaN(e);class Br{constructor(e){this.callback=e,this.executeCallback=this.executeCallback.bind(this)}executeCallback(){this.lastRunTime=performance.now(),Ir(this.timerId)&&(clearTimeout(this.timerId),delete this.timerId),this.callback()}run(){if(!Ir(this.timerId)){if(Ir(this.lastRunTime)){const e=performance.now()-this.lastRunTime;if(e<Br.THROTTLE_DELAY_MS)return void(this.timerId=window.setTimeout(this.executeCallback,Br.THROTTLE_DELAY_MS-e))}this.timerId=window.setTimeout(this.executeCallback)}}}e(Br,"THROTTLE_DELAY_MS",150);const Mr=["mouseover","mouseleave","mouseenter","mouseout"],Lr=["keydown","keypress","keyup","auxclick","click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup","pointerlockchange","pointerlockerror","select","wheel"],Fr=["wheel"];class Dr{constructor(){e(this,"getLastEventType",(()=>this.lastEventType)),e(this,"getTimeSinceLastEvent",(()=>this.lastEventTime?Date.now()-this.lastEventTime:null)),this.trackedEvents=Ct?Lr.filter((e=>!Fr.includes(e))):Lr,this.trackedEvents.forEach((e=>{document.documentElement.addEventListener(e,this.trackEvent,!0)}))}trackEvent(e){this.lastEventType=e.type,this.lastEventTime=Date.now()}isIgnoredEventType(){const e=this.getLastEventType(),t=this.getTimeSinceLastEvent();return!!e&&Mr.includes(e)&&!!t&&t<10}stopTracking(){this.trackedEvents.forEach((e=>{document.documentElement.removeEventListener(e,this.trackEvent,!0)}))}}function Hr(e){e.isDomObserved&&(e.isDomObserved=!1,e.domMutationObserver&&e.domMutationObserver.disconnect(),e.eventTracker&&e.eventTracker.stopTracking())}const _r=/^("|')adguard.+?/,Vr=(e,t)=>{const{node:r}=t;t.removed=!0;const n=(e=>{if(!(e instanceof Element))throw new Error("Function received argument with wrong type");let t;t=e;const r=[];for(;t&&t.nodeType===Node.ELEMENT_NODE;){let e=t.nodeName.toLowerCase();if(t.id&&"string"==typeof t.id){e+=`#${t.id}`,r.unshift(e);break}let n=t,s=1;for(;n.previousElementSibling;)n=n.previousElementSibling,n.nodeType===Node.ELEMENT_NODE&&n.nodeName.toLowerCase()===e&&(s+=1);1!==s&&(e+=`:nth-of-type(${s})`),r.unshift(e),t=t.parentElement}return r.join(" > ")})(r),s=e.removalsStatistic[n]||0;s>50?Rt.error(`ExtendedCss: infinite loop protection for selector: '${n}'`):r.parentElement&&(r.parentElement.removeChild(r),e.removalsStatistic[n]=s+1)},Ur=(e,t)=>{e instanceof HTMLElement&&Object.keys(t).forEach((r=>{if(void 0!==e.style.getPropertyValue(r.toString())){let n=t[r];if(!n)return;if(r===oe&&n.match(_r))return;n=((e,t)=>{const r=e.indexOf(t,e.length-t.length);return r>=0?e.substring(0,r):e})(n.trim(),"!important").trim(),e.style.setProperty(r,n,"important")}}))},Wr=(e,t)=>{if(t.protectionObserver)return;let r;if(e.beforeStyleApplied){if(!(e=>"node"in e&&"rules"in e&&e.rules instanceof Array)(t))throw new Error("Returned IAffectedElement should have 'node' and 'rules' properties");if(r=e.beforeStyleApplied(t),!r)throw new Error("Callback 'beforeStyleApplied' should return IAffectedElement")}else r=t;if(!(e=>"node"in e&&"originalStyle"in e&&"rules"in e&&e.rules instanceof Array)(r))throw new Error("Returned IAffectedElement should have 'node' and 'rules' properties");const{node:n,rules:s}=r;for(let t=0;t<s.length;t+=1){const o=s[t],i=null==o?void 0:o.selector,a=null==o?void 0:o.style,l=null==o?void 0:o.debug;if(a){if(a[Q]===ie)return void Vr(e,r);Ur(n,a)}else if(!l)throw new Error(`No style declaration in rule for selector: '${i}'`)}},qr=e=>{e.protectionObserver&&e.protectionObserver.disconnect(),e.node.style.cssText=e.originalStyle};class zr{constructor(e){this.styleProtectionCount=0,this.observer=new $t.MutationObserver((t=>{t.length&&(this.styleProtectionCount+=1,e(t,this))}))}observe(e,t){this.styleProtectionCount<50?this.observer.observe(e,t):Rt.error("ExtendedCss: infinite loop protection for style")}disconnect(){this.observer.disconnect()}}const Gr={attributes:!0,attributeOldValue:!0,attributeFilter:["style"]},jr=(e,t)=>{if(!$t.MutationObserver)return null;const r=[];t.forEach((e=>{const{style:t}=e;t&&r.push(t)}));const n=new zr((e=>(t,r)=>{if(!t[0])return;const{target:n}=t[0];r.disconnect(),e.forEach((e=>{Ur(n,e)})),r.observe(n,Gr)})(r));return n.observe(e,Gr),n};class Qr{constructor(){this.appliesTimings=[],this.appliesCount=0,this.timingsSum=0,this.meanTiming=0,this.squaredSum=0,this.standardDeviation=0}push(e){this.appliesTimings.push(e),this.appliesCount+=1,this.timingsSum+=e,this.meanTiming=this.timingsSum/this.appliesCount,this.squaredSum+=e*e,this.standardDeviation=Math.sqrt(this.squaredSum/this.appliesCount-Math.pow(this.meanTiming,2))}}const Yr=e=>Number(e.toFixed(4)),Kr=e=>{const t=[];Hr(e),e.parsedRules.forEach((r=>{const n=((e,t)=>{const r=!!t.debug||e.debug;let n;r&&(n=performance.now());const{ast:s}=t,o=[];try{o.push(...cr(s))}catch(t){e.debug&&Rt.error(Pt(t))}if(o.forEach((r=>{let n=(s=e.affectedElements,o=r,s.find((e=>e.node===o)));var s,o;if(n)n.rules.push(t),Wr(e,n);else{const s=r.style.cssText;n={node:r,rules:[t],originalStyle:s,protectionObserver:null},Wr(e,n),e.affectedElements.push(n)}})),r&&n){const e=performance.now()-n;t.timingStats||(t.timingStats=new Qr),t.timingStats.push(e)}return o})(e,r);Array.prototype.push.apply(t,n),r.debug&&(r.matchedElements=n)}));let r=e.affectedElements.length;for(;r;){const n=e.affectedElements[r-1];if(!n)break;t.includes(n.node)?n.removed||n.protectionObserver||(n.protectionObserver=jr(n.node,n.rules)):(qr(n),e.affectedElements.splice(r-1,1)),r-=1}!function(e){e.isDomObserved||(e.isDomObserved=!0,e.domMutationObserver=new $t.MutationObserver((t=>{if(!t||0===t.length)return;const r=new Dr;r.isIgnoredEventType()&&function(e){return!e.some((e=>"attributes"!==e.type))}(t)||(e.eventTracker=r,e.scheduler.run())})),e.domMutationObserver.observe(document,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["id","class"]}))}(e),(e=>{if(e.areTimingsPrinted)return;e.areTimingsPrinted=!0;const t={};e.parsedRules.forEach((e=>{if(e.timingStats){const{selector:n,style:s,debug:o,matchedElements:i}=e;if(!s&&!o)throw new Error(`Rule should have style declaration for selector: '${n}'`);const a={selectorParsed:n,timings:(r=e.timingStats,{appliesTimings:r.appliesTimings.map((e=>Yr(e))),appliesCount:Yr(r.appliesCount),timingsSum:Yr(r.timingsSum),meanTiming:Yr(r.meanTiming),standardDeviation:Yr(r.standardDeviation)})};s&&s[Q]===ie?a.removed=!0:(a.styleApplied=s||null,a.matchedElements=i),t[n]=a}var r})),0!==Object.keys(t).length&&Rt.info("[ExtendedCss] Timings in milliseconds for %o:\n%o",window.location.href,t)})(e)};class Xr{constructor(e){if(!e)throw new Error("ExtendedCss configuration should be provided.");if(this.applyRulesCallbackListener=this.applyRulesCallbackListener.bind(this),this.context={beforeStyleApplied:e.beforeStyleApplied,debug:!1,affectedElements:[],isDomObserved:!1,removalsStatistic:{},parsedRules:[],scheduler:new Br(this.applyRulesCallbackListener)},(t=navigator.userAgent).includes("MSIE")||t.includes("Trident/"))Rt.error("Browser is not supported by ExtendedCss");else{var t;if(!e.styleSheet&&!e.cssRules)throw new Error("ExtendedCss configuration should have 'styleSheet' or 'cssRules' defined.");if(e.styleSheet)try{this.context.parsedRules.push(...((e,t)=>{const r=e.trim();if(r.includes(`${p}${R}`)&&r.includes(`${R}${p}`))throw new Error(`${we} in stylesheet: '${r}'`);const n={isSelector:!0,nextIndex:0,cssToParse:r,selectorBuffer:"",rawRuleData:{selector:""}},s=pr();let o;for(;n.cssToParse;)if(n.isSelector){if(n.nextIndex=n.cssToParse.indexOf(f.LEFT),0===n.selectorBuffer.length&&0===n.nextIndex)throw new Error(`${de}: '${n.cssToParse}'`);-1===n.nextIndex?n.selectorBuffer=n.cssToParse:n.selectorBuffer+=n.cssToParse.slice(0,n.nextIndex),o=Or(n,t),o.success?(n.rawRuleData.selector=o.selector.trim(),n.rawRuleData.ast=o.ast,n.rawRuleData.rawStyles=o.stylesOfSelector,n.isSelector=!1,-1===n.nextIndex?(mr(s,n.rawRuleData),Ar(n)):(n.nextIndex=1,n.selectorBuffer="")):(n.selectorBuffer+=f.LEFT,n.cssToParse=n.cssToParse.slice(1))}else{var i;const e=Cr(n);null===(i=n.rawRuleData.rawStyles)||void 0===i||i.push(...e),mr(s,n.rawRuleData),n.nextIndex=0,Ar(n),n.isSelector=!0}return gr(s)})(e.styleSheet,dr))}catch(e){throw new Error(`Pass the rules as configuration.cssRules since configuration.styleSheet cannot be parsed because of: '${Pt(e)}'`)}if(e.cssRules&&this.context.parsedRules.push(...((e,t)=>{const r=pr(),n=[];return[...new Set(e.map((e=>e.trim())))].forEach((e=>{try{mr(r,xr(e,t))}catch(t){const r=Pt(t);n.push(`'${e}' - error: '${r}'`)}})),n.length>0&&Rt.info(`Invalid rules:\n  ${n.join("\n  ")}`),gr(r)})(e.cssRules,dr)),this.context.debug=e.debug||this.context.parsedRules.some((e=>e.debug===ae)),this.context.beforeStyleApplied&&"function"!=typeof this.context.beforeStyleApplied)throw new Error(`Invalid configuration. Type of 'beforeStyleApplied' should be a function, received: '${typeof this.context.beforeStyleApplied}'`)}}applyRulesCallbackListener(){Kr(this.context)}init(){kt.setGetter()}apply(){Kr(this.context),"complete"!==document.readyState&&document.addEventListener("DOMContentLoaded",this.applyRulesCallbackListener,!1)}dispose(){Hr(this.context),this.context.affectedElements.forEach((e=>{qr(e)})),document.removeEventListener("DOMContentLoaded",this.applyRulesCallbackListener,!1)}getAffectedElements(){return this.context.affectedElements}static query(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if("string"!=typeof e)throw new Error("Selector should be defined as a string.");const r=performance.now();try{return dr.querySelectorAll(e)}finally{const e=performance.now();t||Rt.info(`[ExtendedCss] Elapsed: ${Math.round(1e3*(e-r))} μs.`)}}static validate(e){try{const{selector:t}=hr(e);return Xr.query(t),{ok:!0,error:null}}catch(t){return{ok:!1,error:`Error: Invalid selector: '${e}' -- ${Pt(t)}`}}}}function Jr(e){return new Promise((t=>{setTimeout(t,e)}))}const Zr=window.innerWidth||document.documentElement.clientWidth,en=window.innerHeight||document.documentElement.clientHeight;let tn=0;const rn=async function(e){const t=e.getBoundingClientRect();if(!(t.top>=0&&t.left>=0&&t.top<=en&&t.right<=Zr))return;if(tn>=8)return;tn+=1;const r=t.left+t.width/6||0,n=t.left+5*t.width/6||400,s=r+Math.random()*(n-r),o=t.top,i=Math.floor(400*Math.random())+300;await Jr(i);let a=!1;o<20&&(a=!0);const l=document.createElement("div"),c=l.attachShadow({mode:"closed"});document.body.append(l);const d=300,u=document.createElement("img");u.src="https://cdn.pie.org/pie-coin.svg",u.style=`width: 24px;\n    height: 24px;\n    left: ${s}px; top: ${o-(a?-10:20)}px;\n    z-index: 2147483647;\n    transition: all 0.3s ease-in;\n    position: fixed;\n  `,c.append(u),await Jr(1),u.style.top=o-(a?-40:50)+"px",u.style.transform="rotate(180deg)",await Jr(d),u.style.top=o-(a?-15:35)+"px",u.style.transform="rotate(360deg)",await Jr(470),u.style.opacity=0,await Jr(d),u.remove()};function nn(e){return new Promise((t=>{setTimeout(t,e)}))}const sn={defaultGradient:function(){const e="linear-gradient(125deg, #AD4ABB 23.57%, #696AF6 59.28%, #38B4A8 92.99%)";return{name:"default-gradient",beforeEffect:t=>{t.style.opacity=0,t.style.background=e,setTimeout((()=>{t.style.transition="all 0.275s linear",t.style.opacity=100}),2)},destroyEffect:e=>{e.style.transition="all 0.5s linear",e.style.backgroundColor="white",e.style.scale="0",e.style.opacity=0,e.style.minHeight="0px",e.style.minWidth="0px"},afterEffect:async e=>{e.style.display="none",e.style.zIndex=""},resetEffect:async(t,{height:r})=>{t.style.transition="opacity 0.5s ease-in",t.style.opacity=0,"none"===window.getComputedStyle(t).display&&(t.style.display="block"),t.style.scale="",t.style.minHeight=`${r}px`,await nn(1),t.style.transition="all 0.55s linear",t.style.opacity=100,t.style.background=e},appendEffect:()=>{},overlayBackground:`background: ${e};`,displayDelayMs:550,animationTimeMs:550}}(),moneyMode:function(){const e="#FEF6DD";return{name:"money-mode",beforeEffect:t=>{t.style.opacity=0,t.style.background=e,t.style.backgroundImage='url("https://cdn.pie.org/images/sunburst-animation.svg")',t.style.backgroundPosition="center",t.style.backgroundSize="cover",t.style.outline="4px dashed #EAAA08",t.style.borderRadius="16px";const r=document.createElement("div");r.setAttribute("id","rewards-badge"),r.style='\n        background-image: url("https://cdn.pie.org/images/rewards-badge.svg");\n        background-position: center;\n        background-size: cover;\n        height: 64px;\n        left: 50%;\n        position: absolute;\n        top: 50%;\n        transform: translate(-50%, -50%);\n        width: 64px;\n      ',t.appendChild(r);const n=r.getBoundingClientRect();(n.left<t.getBoundingClientRect().left||n.top<t.getBoundingClientRect().top)&&(t.style.position="relative"),setTimeout((()=>{t.style.transition="all 0.275s linear",t.style.opacity=100}),2)},destroyEffect:e=>{e.style.backgroundColor="white",e.style.scale="0",e.style.opacity=0,e.style.minHeight="0px",e.style.minWidth="0px",rn(e)},afterEffect:e=>{e.style.display="none",e.style.zIndex="";const t=document.getElementById("rewards-badge");t&&t.remove()},resetEffect:async(t,{height:r})=>{t.style.transition="opacity 0.5s ease-in",t.style.opacity=0,"none"===window.getComputedStyle(t).display&&(t.style.display="block"),t.style.scale="",t.style.minHeight=`${r}px`,await nn(1),t.style.transition=`all ${550/1200}s linear`,t.style.opacity=100,t.style.background=e,t.style.backgroundImage='url("https://cdn.pie.org/images/sunburst-animation.svg")',t.style.backgroundPosition="center",t.style.backgroundSize="cover",t.style.outline="4px dashed #EAAA08",t.style.borderRadius="16px"},appendEffect:()=>{},overlayBackground:`\n      background: ${e};\n      background-image: url("https://cdn.pie.org/images/sunburst-animation.svg");\n      background-position: center;\n      background-size: cover;\n      border-radius: 16px;\n    `,displayDelayMs:550,animationTimeMs:550}}()};let on="defaultGradient",an=sn[on];function ln(e,t){return chrome.runtime.sendMessage({name:e,payload:t})}function cn(e,t){chrome.runtime.onMessage.addListener(((r,n,s)=>{r.name===e&&t(r,n,s)}))}let dn=0,un=0,hn=0;function fn(e){return new Promise((t=>{setTimeout(t,e)}))}function pn(e){const t=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth;return Math.max(0,Math.min(e.right,r)-Math.max(e.left,0))*Math.max(0,Math.min(e.bottom,t)-Math.max(e.top,0))}cn("adDetector:getAdPlacementsData",(async(e,t,r)=>{dn>0&&r({numPlacementsFound:dn,numPlacementsVisible:un,percentOfVisibleScreenUsedTotal:hn})})),cn("adDetector:detectSponsoredAds",(async(e,t,r)=>{const n=document.querySelector("link[itemprop=name]").getAttribute("content"),s=document.querySelector('meta[name="description"]').content.toLowerCase().includes("pie.org"),o=document.querySelector(".ytp-paid-content-overlay-link");r({author:n,hasPieInDescription:s,hasSponsoredAd:!!o?.href})}));const mn=[];let wn=!1,gn=!1;function yn(e){wn||gn||(e.forEach((async({el:e,percentOfScreenUsed:t,height:r})=>{const n="auto"!==window.getComputedStyle(e).zIndex?window.getComputedStyle(e).zIndex:0;e.style.zIndex=n+t,e.style.display="",await an.resetEffect(e,{percentOfScreenUsed:t,height:r}),"moneyMode"===on?function(e,t){const r="auto"!==window.getComputedStyle(e).zIndex?window.getComputedStyle(e).zIndex:0,n=document.createElement("div");n.style=`\n    ${an.overlayBackground}\n    align-items: center;\n    display: flex;\n    height: 100%;\n    justify-content: center;\n    left: 0;\n    overflow: hidden;\n    position: absolute;\n    top: 0;\n    width: 100%;\n    z-index: ${r+Math.floor(t)};\n  `;const s=document.createElement("img");s.src="https://cdn.pie.org/images/rewards-badge.svg",s.alt="Pie Rewards Badge",s.style="\n    margin-left: 16px;\n    height: 24px;\n    width: 24px;\n  ",n.appendChild(s);const o=document.createElement("div");o.style='\n    color: #CA8504;\n    font-family: "Roboto", Arial, Helvetica, sans-serif;\n    font-size: 16px;\n    font-weight: 600;\n    line-height: 24px;\n    padding: 16px 16px 16px 6px;\n    text-align: center;\n    text-wrap: balance;\n  ',o.textContent="Earned 1pt with Money Mode",n.appendChild(o),e.appendChild(n);const i=n.getBoundingClientRect();(i.left<e.getBoundingClientRect().left||i.top<e.getBoundingClientRect().top)&&(e.style.position="relative"),mn.push(n)}(e,t):function(e,t){if(t<1)return;const r="auto"!==window.getComputedStyle(e).zIndex?window.getComputedStyle(e).zIndex:0,n=document.createElement("div");n.style=`\n    ${an.overlayBackground}\n    align-items: center;\n    display: flex;\n    height: 100%;\n    justify-content: center;\n    left: 0;\n    overflow: hidden;\n    position: absolute;\n    top: 0;\n    width: 100%;\n    z-index: ${r+Math.floor(t)};\n  `;const s=document.createElement("div");s.style='\n    color: #ADBAC7;\n    font-family: "Roboto", Arial, Helvetica, sans-serif;\n    font-size: 20px;\n    font-weight: bold;\n    line-height: 30px;\n    padding: 16px;\n    text-align: center;\n    text-wrap: balance;\n  ',s.textContent=`This ad takes up ${t.toFixed(0)}% of the screen`,n.appendChild(s),e.appendChild(n);const o=n.getBoundingClientRect();(o.left<e.getBoundingClientRect().left||o.top<e.getBoundingClientRect().top)&&(e.style.position="relative"),mn.push(n)}(e,t)})),wn=!0)}function bn(e){const t=[];if(e.forEach((async({el:e,selector:r})=>{e.style.display="none",e.style.zIndex="";const n=e.getBoundingClientRect();(n.height||n.width)&&(t.push(r),e.remove())})),t.length){ln("adDetector:hide_ads_permanently",{selectorsToHidePermanently:[...new Set(t)]})}mn.forEach((e=>{e.remove()}))}function vn(e,t=1200){wn&&!gn&&(gn=!0,e.forEach((({el:e})=>{setTimeout((()=>{an.destroyEffect(e)}),t),setTimeout((()=>{an.afterEffect(e),gn=!1,wn=!1}),an.animationTimeMs+t)})))}let En=()=>{};function $n(e,t){const{trigger:r}=e;r&&function(e,t=15e3,r=100){return new Promise((n=>{let s=0;const o=setInterval((()=>{const i=document.querySelector(e);i?(clearInterval(o),n(i)):s>t&&clearInterval(o),s+=r}),r)}))}(r.parent,15e3,200).then((e=>{var n,s,o;n=e,s=r.selector,o=async()=>{const e=await ln(`adblock:${t}`,{url:window.location.href});e.shouldRefresh||e.showGracefulFail||(e.elementsToClick&&e.elementsToClick.forEach((e=>{document.querySelector(e).click()})),e.delay&&(await new Promise((t=>{setTimeout(t,e.delay)})),e.elementsToClick.forEach((e=>{document.querySelector(e).click()}))),e.elementsToRemove&&e.elementsToRemove.forEach((e=>{document.querySelector(e).remove()})))},new Promise(((e,t)=>{if(!n)return void t(new Error(`Parent element "${n}" not found`));function r(e){const t=window.getComputedStyle(e);if("none"===t.display||"hidden"===t.visibility||"0"===t.opacity)return!1;const r=e.getBoundingClientRect();return r.width>0&&r.height>0}const i=n.querySelector(s);if(i&&r(i))return o(n.querySelector(s)),void e(n.querySelector(s));const a=new MutationObserver((t=>{t.forEach((()=>{const t=n.querySelector(s);t&&r(t)&&(o(t),e(t),a.disconnect())}))}));a.observe(n,{childList:!0,subtree:!0,attributes:!0})}))}))}function kn(){return"visible"===document.visibilityState?Promise.resolve():new Promise((e=>{document.addEventListener("visibilitychange",(function t(){"visible"===document.visibilityState&&(e(),document.removeEventListener("visibilitychange",t))}))}))}async function Sn({adblockVisualMode:e,placementsFound:t,adSelectors:r,isMobile:n,filteredSelectorsToHide:s,eligbleForFairAds:o,tabId:i,frameId:a,domainSpecificRules:l,hostnameSpecificRules:c,selectorsToRemove:d}){if(e?async function({placementsFound:e,adSelectors:t,isMobile:r}){const{displayDelayMs:n,animationTimeMs:s}=an,o=[];gn=!0;const i=document.documentElement.clientHeight*document.documentElement.clientWidth,a=e.map((async({el:e,selector:t})=>{an.beforeEffect(e);const r=e.getBoundingClientRect(),a=pn(r)/i*100,l=`${r.width.toFixed(0)}x${r.height.toFixed(0)}`,c=r.width*r.height/i*100,d=r.width*r.height,u={el:e,adSize:l,rect:r,selector:t,pixelsUsed:d,percentOfVisibleScreenUsed:a,percentOfScreenUsed:c,top:r.top,left:r.left,right:r.right,bottom:r.bottom,height:r.height,width:r.width};return a>.5&&(un+=1,o.push(u)),setTimeout((()=>{an.destroyEffect(e)}),n),setTimeout((()=>{an.afterEffect(e)}),s+n),u}));setTimeout((()=>{bn(e),gn=!1}),n+s+200);let l=0;const c=await Promise.all(a);hn=0,o.filter(((e,t,r)=>t===r.findIndex((t=>t.rect.left===e.rect.left&&t.rect.top===e.rect.top&&t.rect.width===e.rect.width&&t.rect.height===e.rect.height)))).forEach((e=>{hn+=e.percentOfVisibleScreenUsed,l+=e.pixelsUsed})),hn>81&&(hn=81),hn>5&&!r&&(ln("adblock:action:detectAdsPopup",{numPlacementsFound:dn,percentOfVisibleScreenUsedTotal:hn}),En=async()=>{yn(c),vn(c)},window.addReverseVisualModeAds=()=>yn(c),window.animateReverseVisualModeAds=()=>vn(c,0),window.hideAds=()=>{bn(e)}),dn>0&&ln("adDetector:placements_calculated",{percentOfVisibleScreenUsedTotal:hn,numPlacementsVisible:un,numPlacementsFound:dn,adSelectors:t,pixelsUsedTotal:l,mode:"visualMode"})}({placementsFound:t,numPlacementsFound:dn,adSelectors:r,isMobile:n,selectorsToHide:s}):function({placementsFound:e,adSelectors:t}){const r=document.documentElement.clientHeight*document.documentElement.clientWidth,n=e.map((({el:e})=>{e.style.display="block";const t=e.getBoundingClientRect(),{width:n,height:s,top:o,left:i}=t,a=pn(t)/r*100,l=t.width*t.height/r*100;return e.style.display="none",{el:e,rect:t,width:n,height:s,top:o,left:i,percentOfVisibleScreenUsed:a,percentOfScreenUsed:l}})).filter(((e,t,r)=>t===r.findIndex((t=>t.left===e.left&&t.top===e.top&&t.width===e.width&&t.height===e.height&&e.percentOfVisibleScreenUsed>0))));n.forEach((e=>{hn+=e.percentOfVisibleScreenUsed})),dn>0&&ln("adDetector:placements_calculated",{numPlacementsFound:dn,numPlacementsVisible:n.length,mode:"cleanMode",percentOfVisibleScreenUsedTotal:hn,adSelectors:t})}({placementsFound:t,numPlacementsFound:dn,adSelectors:r,isMobile:n,selectorsToHide:s}),o||e){const{displayDelayMs:t,animationTimeMs:r}=an;setTimeout((()=>{ln("adDetector:adblock_remove_ads",{selectorsToHide:s,tabId:i,frameId:a,domainSpecificRules:l,hostnameSpecificRules:c})}),e?t+r+50:0)}d&&(ln("adDetector:hide_ads_permanently",{selectorsToHidePermanently:d}),d.forEach((e=>{const t=document.querySelectorAll(e);t&&t.length&&t.forEach((e=>{e.remove()}))}))),async function(){if("www.youtube.com"===window.location.hostname)return;const e=await ln("adblock:getGracefulFailConfig");Object.entries(e||{}).forEach((([e,t])=>{$n(t,e)}))}()}chrome.runtime.onMessage.addListener((e=>{"adDetector:show_again"===e.name&&En()}));const xn=window.location.href.includes("amazon.com");!async function(){try{const e=Date.now();0;const t=await ln("adDetector:started").catch((e=>(ln("analytics:action:track",{eventName:"ad_detector_start_error",data:{error:e.message},options:{},reason:"Transparency statement: This event is used to monitor in the rare case visual mode fails to run on mobile and helps us monitor critical issues"}),{})));if(0===Object.keys(t).length)return;await Promise.race([ln("moneyMode:action:checkIsActive",null).then((e=>{e&&(on="moneyMode",an=sn[on])})),fn(100)]);const{tabId:r,frameId:n,domainSpecificRules:s,hostnameSpecificRules:o,selectorsToHide:i=[],selectorsToRemove:a,eligbleForFairAds:l,adblockVisualMode:c,isMobile:d,extendedCssSelectors:u=[]}=t;let h,f=!1;if(l)try{await window.findAdNetworkWithRetries();const e=await ln("fairAds:started");h=e.fairAdClassName,f=e.adNetworkFound}catch(e){}l&&!xn&&f&&await fn(3e3),await async function(){return new Promise((e=>{"complete"!==document.readyState&&"loaded"!==document.readyState&&"interactive"!==document.readyState||e(),document.addEventListener("DOMContentLoaded",e)}))}(),await kn(),Date.now()-e<300&&await fn(20);const p=[],m=[],w=[],g=[],y=[];let b;i.forEach((e=>{try{const t=document.querySelectorAll(e);t&&t.length&&t.forEach((t=>xn&&'div[cel_widget_id*="desktop-dp-"]'===e&&t.querySelector(".a-carousel-card")?(p.push({el:t,selector:e}),void(m.includes(e)||m.push(e))):l&&function(e){const t=e.getBoundingClientRect();return t.width>=100&&t.height>=50||t.width>=50&&t.height>=100}(t)?(g.push({el:t,selector:e}),void(w.includes(e)||w.push(e))):(p.push({el:t,selector:e}),void(m.includes(e)||m.push(e)))))}catch(e){}return null})),u.forEach((e=>{try{if(Xr.validate(e)?.ok){const t=Xr.query(e);t&&t.length&&t.forEach((t=>{p.push({el:t,selector:e}),m.includes(e)||m.push(e),y.includes(e)||y.push(e)}))}}catch(e){}})),y.length&&function(e,t){const{displayDelayMs:r,animationTimeMs:n}=an;let s=null;new MutationObserver((o=>{o.forEach((()=>{s||(s=setTimeout((()=>{s=null,e.forEach((e=>{const s=Xr.query(e);s&&s.forEach((e=>{t?(an.beforeEffect(e),setTimeout((()=>{an.destroyEffect(e)}),r),setTimeout((()=>{an.afterEffect(e)}),n+r)):e.remove()}))}))}),500))}))})).observe(document,{childList:!0,subtree:!0})}(y,c),b=l&&h?i.map((e=>w.includes(e)?`${e}:not(.${h})`:e)):i,dn=p.length,l&&h&&g.length?(await new Promise((e=>{if(window.fairAdsListening)e("fairAdsListening is already true");else{const t=()=>{window.fairAdsListening&&(window.removeEventListener("fairAds:listening",t),e("fairAdsListening is now true"))};window.addEventListener("fairAds:listening",t)}})),window.dispatchEvent(new CustomEvent("fairAds:start",{detail:{fairAdPlacementsFound:g,eligbleForFairAds:l}})),window.addEventListener("fairAds:finished",(async()=>{xn&&await ln("adDetector:hide_ads_permanently",{selectorsToHidePermanently:b}),/google\.com/.test(window.location.href)||await Sn({adblockVisualMode:c,placementsFound:p,adSelectors:m,isMobile:d,filteredSelectorsToHide:b,eligbleForFairAds:l,tabId:r,frameId:n,domainSpecificRules:s,hostnameSpecificRules:o,selectorsToRemove:a})}))):await Sn({adblockVisualMode:c,placementsFound:p,adSelectors:m,isMobile:d,filteredSelectorsToHide:b,eligbleForFairAds:l,tabId:r,frameId:n,domainSpecificRules:s,hostnameSpecificRules:o,selectorsToRemove:a})}catch(e){ln("analytics:action:track",{eventName:"ad_detector_init_visual_error",data:{error:e.message},options:{},reason:"Transparency statement: This event is used to monitor when visual mode does not work as expected and helps us monitor the health of the feature over time"})}}()})();