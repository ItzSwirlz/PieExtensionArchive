(()=>{function e(e,t){return chrome.runtime.sendMessage({name:e,payload:t})}const t=/reddit\.com/.test(window.location.href),n=/google\.com/.test(window.location.href);const o=window.location.href.includes("amazon.com");function i(e){let t=5381;for(let n=0;n<e.length;n++)t=33*t^e.charCodeAt(n);return t>>>0}const r="https://cdn.pie.org/pie-adblock-logo-blue-fairads.png";let a=[],d=[];const s=()=>{0!==a.length&&(e("fairAds:action:claimAdViews",a),d=[...d,...a],a=[])},l=2147483647;function c(e="default"){const t=document.createElement("img");return t.id="pie_logo",t.src=r,"pcn"===e?function(){const e=document.createElement("img"),t=document.createElement("div"),n=document.createElement("div");return e.id="pie_logo",e.src=r,e.style.width="20px",e.style.height="20px",e.style.top="7px",e.style.right="7px",e.style.cursor="pointer",e.style.position="absolute",e.style.zIndex="10",n.style.width="0",n.style.height="0",n.style.borderBottom="40px solid #5c59fe",n.style.borderLeft="40px solid transparent",n.style.borderRight="40px solid transparent",n.style.transform="rotate(45deg) translateX(-43px) translateY(33px)",n.style.position="absolute",t.style.zIndex=l,t.style.position="absolute",t.style.right="0",t.style.height="40",t.style.width="40",t.appendChild(e),t.appendChild(n),t}():(t.style.width="17px",t.style.height="17px",t.style.marginRight="5px",t.style.marginBottom=n?"-3px":"0",t.style.cursor="pointer",t.style.position="relative",t.style.zIndex="10",t.style.setProperty("border-top-left-radius","0","important"),t.style.setProperty("border-top-right-radius","0","important"),t)}const p=(n,{type:o="default",defaultOpen:i,timer:r=0,adViewType:a="fair_ad"}={})=>{const d=n?.querySelectorAll("#pie_logo"),s=n?.shadowRoot?.querySelectorAll("#pie_logo"),l=n?.parentNode?.closest("div"),p=n?.closest("div").querySelectorAll("#pie_logo"),u=l?.querySelectorAll("#pie_logo"),h="a-carousel-card"===l?.getAttribute("class"),y=i?"If you see this icon then Pie is intentionally showing this ad as part of Rewards for Ads. Browse the internet and get paid!":"You are receiving Rewards for seeing this ad.";if(0===d?.length&&(0===u?.length||t)&&0===p?.length&&!h&&(!s||0===s?.length)){const d=document.createElement("div");d.id="modal_container",d.style="\n      opacity: 0;\n      position: fixed;\n      width: 248px;\n      padding: 0px;\n      border-radius: 16px 0 16px 16px;\n      flex-direction: column;\n      background-color: white;\n      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);\n      align-items: space-between;\n      z-index: 2147483647;\n      font-family: Roboto, sans-serif;\n      font-weight: 400;\n      transition: opacity 0.3s;\n    ";const s=document.createElement("div");"pcn"===o?(n.insertBefore(s,n.firstChild),d.style.position="absolute",d.style.width="260px",d.style.zIndex=2147483646):document.body.appendChild(s);const l=s.attachShadow({mode:"closed"}),p=c(o),u=document.createElement("div");u.style="display: flex; align-items: center; padding: 12px;",d.appendChild(u);const h=document.createElement("div"),m=document.createElement("div");h.style="width: 100%; height: 3px; background: #F3F4F6; display: flex;",m.style=`width: 0%; height: 100%; background: linear-gradient(125deg, #AD4ABB 23.57%, #696AF6 59.28%, #38B4A8 92.99%); display: flex; transition: width ${r/1e3}s ease-in-out;`,h.appendChild(m),d.appendChild(h);const g=document.createElement("div");g.style="display: flex; align-items: center; justify-content: space-between; align-items: middle; margin-top: 0px; padding: 8px 12px;",d.appendChild(g);const f=document.createElement("img");f.src="https://cdn.pie.org/pie-adblock-logo-blue-fairads.svg",f.style="width: 35px; height: 35px; margin-right: 12px;",u.appendChild(f);const w=document.createElement("p");w.textContent=y,w.style="margin: 0; font-size: 12px; color: #000; line-height: 18px; font-weight: 400; font-family: Roboto, sans-serif;",u.appendChild(w);const b=document.createElement("div");b.style="display: flex; align-items: center; justify-content: center;";const x=document.createElement("a");x.href="https://www.pie.org/settings/ch/adblock",x.target="_blank",x.style="font-size: 14px; color: black; text-decoration: none; display: inline-flex; align-items: center;",x.textContent="Settings";const A=document.createElement("img");A.src="https://cdn.pie.org/pie-adblock-settings-fairads.svg",A.style="width: 20px; height: 20px; margin-right: 5px;",x.insertBefore(A,x.firstChild),b.appendChild(x),x.addEventListener("click",(()=>{e("fairAds:analytic:click",{reason:"change_settings"})})),g.appendChild(b);const v=document.createElement("a");v.href="https://www.pie.org/rewards?tile=FAIR_ADS",v.target="_blank",v.style="font-size: 13px; color: #1E1C76; text-decoration: none; front-weight: 600; font: roboto;",v.textContent="Learn More",g.appendChild(v),v.addEventListener("click",(()=>{e("fairAds:analytic:click",{reason:"learn_more"})})),l.appendChild(d),t?(p.style.marginLeft="7px",n.insertAdjacentElement("afterend",p)):n.insertBefore(p,n.firstChild);const E=p.getBoundingClientRect();2===E.x&&2===E.y&&p.remove();let C=!i;const k=()=>{d.style.display="flex",d.style.opacity="1";const e=p.getBoundingClientRect(),t=d.getBoundingClientRect();d.style.setProperty("top",`${e.bottom}px`,"important");const n=window.innerHeight-e.bottom;let i=!1,r=!1;e.right>window.innerWidth-248?(r=!0,d.style.right=0):e.left<248?(r=!0,d.style.left=0):d.style.right=window.innerWidth-17-e.left-window.scrollX+"px",n<t.height&&(i=!0,d.style.top=e.top-t.height+"px"),"pcn"===o&&(d.style.top="0px",d.style.right="0px"),r?d.style.borderRadius="16px":i&&(d.style.borderRadius="16px 16px 0 16px")};return p.addEventListener("mouseenter",(()=>{C=!0,k(),e("fairAds:analytic:impression",{adViewType:a})})),p.addEventListener("mouseleave",(()=>{C&&setTimeout((()=>{p.matches(":hover")||d.matches(":hover")||(d.style.opacity="0")}),200)})),d.addEventListener("mouseleave",(()=>{C&&(d.style.opacity="0")})),i&&k(),i&&r&&(m.style.width="100%",setTimeout((()=>{d.style.opacity="0",m.style.width="0%"}),r)),!0}return!1};let u,h=!1;function y(o,i,r=!1,a="Sponsored"){const d=o.querySelectorAll("span");let s=!1;d.forEach((d=>{if(d.textContent.trim().toLowerCase()===a.toLowerCase()&&!s){s=!0,o.classList.add(i);const a=n||t?d:d.closest("div");if(r&&!h){const t=function(e){const t=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth;return Math.max(0,Math.min(e.right,n)-Math.max(e.left,0))*Math.max(0,Math.min(e.bottom,t)-Math.max(e.top,0))}(a.getBoundingClientRect());t>0&&(r=!1,h=!0,p(a,{timer:5e3,defaultOpen:!0}),e("fairAds:action:viewFirstTimeFairAds"))}else p(a)}}))}function m(){const e=[];let n=document.querySelectorAll("#pie_logo");if(0===n.length&&t){document.querySelectorAll("*").forEach((e=>{if(e.shadowRoot){const t=e?.shadowRoot?.querySelector("#pie_logo");t&&(n=[...n,t])}}))}n.forEach((t=>{const n=t.closest("div"),o=n.getBoundingClientRect();if(0!==o.x&&0!==o.y&&o.bottom>0&&o.right>0&&o.top<window.innerHeight&&o.left<window.innerWidth){const o=i(n.outerHTML);e.push(t),a.includes(o)||d.includes(o)||a.push(o)}})),clearTimeout(u),u=setTimeout(s,2e3)}window.location.href.match(/youtube\.com/)?async function(){const t=(await e("fairAds:action:getPCNYouTubeChannels")).reduce(((e,t)=>({...e,[t.channelName]:{...t,network:"youtube"},[t.handle]:{...t,network:"youtube"}})),{}),n=window.location.href;function o(){const e=document.querySelector("[itemprop=author] [itemprop=name]"),o=e&&e.getAttribute("content"),i=document.querySelector("#upload-info .ytd-channel-name[title]");let r;return o&&window.location.href===n&&(r=o),i&&(r=i.getAttribute("title")),t[r]}const r=((e,t)=>{let n=null;return(...o)=>{window.clearTimeout(n),n=window.setTimeout((()=>{e(...o)}),t)}})((async t=>{document.head.querySelector("#pstyles")||document.head.insertAdjacentHTML("beforeend",'\n        <style id="pstyles">\n          .gradient-border:has(.ytp-ad-player-overlay-layout) {\n            position: relative;\n            border-radius: var(--border-radius);\n            padding: 4px;\n            --border-radius: 16px;\n            z-index: 1;\n          }\n          .gradient-border:has(.ytp-ad-player-overlay-layout):after,\n          .gradient-border:has(.ytp-ad-player-overlay-layout):before {\n            content: "";\n            position: absolute;\n            top: -1px;\n            left: -1px;\n            bottom: -1px;\n            right: -1px;\n            background: linear-gradient(125deg, #5C59FE 25%, #768CFF 50%, #DA8BFF 75%, #5C59FE 100%);\n            background-size: 400%;\n            z-index: -1;\n            animation: glow 8s linear infinite;\n            border-radius: var(--border-radius);\n          }\n          .gradient-border:has(.ytp-ad-player-overlay-layout):after {\n            filter: blur(14px);\n            transform: translate3d(0, 0, 0);\n          }\n          @keyframes glow {\n            0% {\n              background-position: 0% 50%;\n            }\n            50% {\n              background-position: 100% 50%;\n            }\n            100% {\n              background-position: 0% 50%;\n            }\n          }\n\n          /* Theater mode mods */\n          #full-bleed-container.gradient-border {\n            padding: 3px;\n            box-sizing: border-box;\n            --border-radius: 0px;\n          }\n        </style>\n      ');const n=document.querySelector("#player-container-outer"),r=document.querySelector("#full-bleed-container");n&&!n.className.includes("gradient-border")&&(n.className+=" gradient-border"),r&&!r.className.includes("gradient-border")&&(r.className+=" gradient-border",r.className+=" gradient-border");const a=await e("fairAds:action:canShowPCNPopup"),d=p(t.parentNode,{defaultOpen:a,timer:6e3,adViewType:"pie_creator_fair_ad",type:"pcn"});if(d&&a&&e("fairAds:action:showPCNPopup"),d){const n=o();e("adblock:action:fairAdsEarningPopup",{}),e("fairAds:action:claimPCNAdView",{adViewId:i(t.outerHTML),metadata:{network:n.network,creatorHandle:n.handle,creatorid:n.creatorId}})}}),50),a={};async function d(){if(!await e("fairAds:action:checkUserAdsEligibility"))return;const t=o();if(!window.location.href.includes("watch")||!t)return;const n=await e("adblock:action:isTabTemporarilyUnblocked");a[window.location.href]=n,n||await e("adblock:action:loadPCNVideo",t)}new MutationObserver((()=>{const e=document.querySelector(".ytp-ad-player-overlay-layout"),t=a[window.location.href],n=e&&e.querySelector("#pie_logo");e&&t&&!n&&r(e)})).observe(document,{childList:!0,subtree:!0}),window.addEventListener("yt-page-data-updated",d),d()}():(window.addEventListener("fairAds:start",(async function(n){const{fairAdPlacementsFound:i,eligbleForFairAds:r}=n.detail;if(!r)return;await window.findAdNetworkWithRetries();const{fairAdClassName:a,isFirstTimeFairAds:d}=await e("fairAds:started");i.forEach((({el:e})=>{y(e,a,d,t?"Promoted":"Sponsored")})),t&&new MutationObserver((function(e){e.forEach((e=>{"childList"===e.type&&e.addedNodes.length>0&&e.addedNodes.forEach((e=>{e.nodeType===Node.ELEMENT_NODE&&e.shadowRoot&&e.querySelectorAll("span").forEach((e=>{e.textContent.includes("Promoted")&&p(e)}))}))}))})).observe(document.body,{childList:!0,subtree:!0});var s;m(),document.addEventListener("scroll",m),window.dispatchEvent(new Event("fairAds:finished")),o&&(await(s=50,new Promise((e=>{setTimeout(e,s)}))),function(t,n){t&&document.querySelectorAll('[data-uuid]:not([data-uuid=""]):not([cel_widget_id^="MAIN-PAGINATION"])').forEach((t=>{let o=!1;t.querySelectorAll(`.${n}`).length>0&&(o=!0),t.addEventListener("click",(()=>{e("fairAds:analytic:clickProductLink",{isSponsored:o})}))}))}(r,a))})),window.fairAdsListening=!0,window.dispatchEvent(new Event("fairAds:listening")))})();